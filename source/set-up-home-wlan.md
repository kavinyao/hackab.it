# 打造家庭无线网络

- pubdate: 2012-01-15
- tags: geek, home, wlan

---

昨天花了3个小时，终于完成了一个长久的愿望，把家里的有线网改造成了无线网，彻底摆脱了线的束缚。现在，台式机，笔记本，手机都能自由享受WLAN了。

有些事情看似容易，实际做起来其实不简单。这次的改造，说白了其实就配置一下无线路由，给台式机插两块PCI网卡的事情，但其间还是碰上了一些小麻烦。记下来，既是对自己一次Geek活动的记录，也希望能给大家分享一些经验。

## 缘由

先说点历史吧。家里第一台电脑是在我初二的时候买的，大概是搬进现在这个家的第三年吧。宽带的接入口在二楼书房，反正只有一台电脑，于是就放书房了，和小猫在一起其乐融融，也没有多少不便。

**变化总是难以预料的，我们很少为未来做充分的准备**。由于书房没有空调，加上父母担心我自制力不强，就把电脑转移到了他们房间里，这样，夏天就不怕高温，我用电脑的时间也可以被限制。不过，由于接入口无法挪动，一根长长的网线就从书房拖到了我父母房里，中间经过3扇门，其中一扇门无法完全关闭。

后来，作为对我顺利进入苏高中的奖励，高一那年，按照我自己的装机单配了一台电脑——看多了《微型计算机》，有一次亲历DIY的经历还是非常满足的。不过，麻烦就是，由于电脑放在我自己房间里，又一根网线拉到了我房间里。由于路由在书房，从书房出去的两根网线使书房的门也无法完全关闭了。

后面的情况大家应该都能预料到。家里又多了一台笔记本，然后我上大学也买了一台，由于路由没有WLAN功能，**最坏的情况下，需要四根网线来保证网络**（发生于去年看春晚的时候）。今年，爸妈和我的手机都换成智能机了，**单一的网络接入模式和众多网络设备之间的矛盾已经极其突出**。

我算是一个80%的完美主义者，拉第一根网线的时候，我就不是很喜欢这种不优雅的解决方式。后来，我想过的方案包括：

1. 让网线从书房拉到屋外，绕外墙再接到各个房间
1. 把二楼的地板都掀了，重新布线

不过这两种方案的成本都太高了，**人总是趋向于选择满足条件的最平衡方案**，所以我们选择了将就。不过，拉网线这种方法的固有缺陷是无法克服的：可扩展性太差。第一，网络设备越来越多，路由器的网口是固定的（书房里的DI-504只有4个LAN口）；第二，越来越多的网络设备只有WLAN接入了。**我们需要一种可扩展的、以不变应万变的方法**。

无线路由顺理成章进入了视野。大多数无线路由在WLAN之外，还提供LAN接口，可以满足台式机和其他WLAN设备的需要。不过受网线的折磨太久，我更倾向于一个更加彻底的方案：给台式机也装上无线网卡，将网络彻底无线化。于是，说干就干，淘宝上定的货前天终于到了，可以开始改造。

## 准备

首先，不再满足需要的DI-504肯定要被淘汰掉，需要一个无线路由来代替它。找了一番，两天线的DIR-618满足需要，后来发现三天线的DIR-619贵不了几十块，理论速率更快、覆盖范围更大，于是就选了后一个。

台式机无线网卡，先是在USB和PCI之间纠结了一会儿。USB虽然有一定的灵活性，但考虑到插上了估计也不会再拔了（网线都没了嘛），而且外置的总觉得有些碍眼，后来还是选了PCI的。淘宝上同一家店定了两块DWA-525。DWA-525规格是150Mbps的，DIR-619是300Mbps的，现在看可能浪费了路由的性能，可将来要是有新的300M设备呢？有了之前的经验，还是给自己留点余地吧。

<a href="http://hackab.it/wp-content/uploads/2012/01/001.jpg"><img class="alignnone size-full wp-image-67" title="DIR-619 and DWA-525" src="http://hackab.it/wp-content/uploads/2012/01/001.jpg" alt="DIR-619 and DWA-525" width="500" height="348" /></a>

然后，拆机箱螺丝刀是必备的，家里有一盒如下的工具套装， 关键时刻能派上不少用处。

<a href="http://hackab.it/wp-content/uploads/2012/01/002.jpg"><img class="alignnone size-full wp-image-68" title="screw driver set" src="http://hackab.it/wp-content/uploads/2012/01/002.jpg" alt="screw driver set" width="500" height="316" /></a>

最后，还需要一个懂基本网络知识，能拆机，耐挫力强的苦力，就是我啦。

## 步骤

无线路由安装：先把DI-504的线都拔了，把DIR-619连到modem上用把包装里自带的网线连上笔记本配置WLAN和PPPoE。配置完毕重启，用笔记本电脑进行无线网络的测试。

无线网卡安装：关机，打开机箱盖板，取下PCI挡板，插上PCI网卡。开机，安好驱动，连接无线网测试。一切完毕再装回盖板。

<a href="http://hackab.it/wp-content/uploads/2012/01/003.jpg"><img class="alignnone size-full wp-image-69" title="Installing PCI Network Card" src="http://hackab.it/wp-content/uploads/2012/01/003.jpg" alt="Installing PCI Network Card" width="500" height="394" /></a>

清理工作：终于可以把乱糟糟的网线都收起来了！把无线路由挪到走道，让每个房间都能有不错的信号强度。

<a href="http://hackab.it/wp-content/uploads/2012/01/004.jpg"><img class="alignnone size-full wp-image-70" title="Cable lines, before and after" src="http://hackab.it/wp-content/uploads/2012/01/004.jpg" alt="Cable lines, before and after" width="500" height="492" /></a>

## 波折

*The Devil is in the details*. 上面的步骤看起来容易，其实细节上还是遇到了不少问题。

首先是PCI网卡的相关问题：家里两台电脑是否支持PCI？PCI能否热插拔？对于前一个问题，我房间里的比较新，应该没问题；父母房间里的，我拆开来看了下，主板上躺着的是一颗古董级的SiS 964的南桥，网上查了一下，也是支持的（其实拆开来看到主板上三个PCI插槽我就放心了）。热插拔的问题，网上说法不一，保险起见，我还是关机操作吧。

说来惭愧，没有插PCI卡的经验，所以插无线网卡也费了一些时间。要同时金手指对准插槽、挡板对准挡板口还真是个技巧活，对准了也不敢贸然用力，就怕挤坏主板。多次尝试之后，顺利安装完成。

虽然网卡的包装自带了安装光盘，但鉴于以往的经验，Windows Update应该会自动寻找驱动，所以给第一台电脑安装时我没装驱动直接装了网卡。结果设备无法识别（不知道是网卡较新，微软没有收录，还是什么其他原因）。给第二台电脑安装的时候，才看到网卡的包装上写着：IMPORTANT! Please install the software from the bundled CD-ROM before inserting the Adapter. **看来万事不能想当然，仔细阅读说明真的很重要，可以避免不必要的麻烦**。

其次是PPPoE密码的问题。DI-504用了好多年了，一直都是自动连接PPPoE的；上次电信上门装iTV还换过宽带密码。密码究竟是什么？这下配置DIR-619的时候就遇到瓶颈了。而且又是星期六，打电信恐怕也没有技术支持。尝试找电脑中的密码记录，无果；看DI-504的配置界面input元素的value，无果（是硬编码的******）。最后终于发现，DI-504有个配置保存功能，是不是可以试试呢？最后的稻草只能抓一抓了，下载下来是一个profile.bin文件，用Vim打开，果然有个POE_PASS字段，问题解决！:)

<a href="http://hackab.it/wp-content/uploads/2012/01/Capture.png"><img class="alignnone size-full wp-image-72" title="profile.bin" src="http://hackab.it/wp-content/uploads/2012/01/Capture.png" alt="profile.bin" width="500" height="349" /></a>

## 结果

现在，家里的网络是一个完全的无线网。没有了网线的束缚，门都能关上了，眼睛看着也舒服很多。同时，无限网络的扩展性比有线网好多了，虽然可靠性可能会低一些。这两天使用下来，感觉还不错，一般都在100Mbps以上，有一小段时候会很诡异地降到1~2Mbps。

当然，本质上接入到家的网速还是没变（4Mbps的水平），不知道电信提速的春风何时能吹到我家。

### update history

01/15/2012 16:42 修改了一处错别字
